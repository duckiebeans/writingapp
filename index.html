<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Rich Writer</title>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #1a1a1a;
            --ui-border: #eeeeee;
            --ui-bg: #fdfdfd;
            --accent: #3498db;
            --sidebar-bg: #f8f9fa;
            --font-serif: "EB Garamond", serif;
            --font-sans: "Inter", sans-serif;
        }

        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --ui-border: #333333;
            --ui-bg: #222222;
            --sidebar-bg: #121212;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: var(--font-sans);
            overflow: hidden;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid var(--ui-border);
            background: var(--ui-bg);
            z-index: 10;
        }

        .workspace {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 260px;
            min-width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--ui-border);
            display: flex;
            flex-direction: column;
            padding: 1rem;
            transition: margin-left 0.3s ease, opacity 0.3s ease;
            gap: 20px;
        }

        .sidebar.hidden { margin-left: -260px; opacity: 0; pointer-events: none; }

        .sidebar-section { display: flex; flex-direction: column; flex-grow: 0; }
        .sidebar-label { font-weight: 600; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 10px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; }

        #file-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; max-height: 200px; }
        .file-item { 
            padding: 6px 10px; 
            font-size: 0.85rem; 
            cursor: pointer; 
            border-radius: 4px; 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 2px;
        }
        .file-item:hover { background: var(--ui-border); }
        .file-item.active { background: var(--accent); color: white; }
        .delete-file { opacity: 0.5; font-size: 0.7rem; }
        .delete-file:hover { opacity: 1; color: #e74c3c; }

        #notes-area {
            height: 150px;
            background: transparent;
            border: 1px solid var(--ui-border);
            border-radius: 4px;
            outline: none;
            color: var(--text-color);
            font-family: var(--font-sans);
            font-size: 0.85rem;
            padding: 8px;
            resize: none;
        }

        .main-container { flex-grow: 1; overflow-y: auto; padding: 3rem 1rem; display: flex; justify-content: center; }

        #editor {
            width: 100%;
            max-width: 750px;
            min-height: 100%;
            outline: none;
            line-height: 1.8;
            font-family: var(--font-serif) !important;
            font-size: 18px;
        }

        #editor blockquote { border-left: none; margin: 0 0 0 40px; }

        .controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .format-group { display: flex; border: 1px solid var(--ui-border); border-radius: 4px; background: var(--bg-color); }
        .format-btn { background: transparent; border: none; border-right: 1px solid var(--ui-border); padding: 6px 12px; cursor: pointer; color: var(--text-color); display: flex; align-items: center; }
        .format-btn:last-child { border-right: none; }
        .format-btn:hover { background: var(--ui-border); }

        footer { display: flex; justify-content: space-between; padding: 0.6rem 1.5rem; border-top: 1px solid var(--ui-border); background: var(--ui-bg); font-size: 0.75rem; color: #888; }
        .action-btn { padding: 5px 8px; border: 1px solid var(--ui-border); border-radius: 4px; background: var(--bg-color); color: var(--text-color); cursor: pointer; }
        .download-btn { background-color: var(--accent); color: white; border: none; }
        svg { width: 14px; height: 14px; fill: currentColor; }
    </style>
</head>
<body>

    <nav>
        <div style="display: flex; align-items: center; gap: 15px;">
            <button class="action-btn" onclick="toggleSidebar()">‚â°</button>
            <div style="font-weight: 600; letter-spacing: 0.5px;">WRITER</div>
        </div>
        
        <div class="controls">
            <div class="format-group">
                <button class="format-btn" onclick="apply('bold')"><b>B</b></button>
                <button class="format-btn" onclick="apply('italic')"><i>I</i></button>
                <button class="format-btn" onclick="apply('underline')"><u>U</u></button>
            </div>

            <div class="format-group">
                <button class="format-btn" onclick="apply('outdent')" title="Outdent">
                    <svg viewBox="0 0 24 24"><path d="M11 17h10v-2H11v2zm-8-5 4 4V8l-4 4zm0 9h18v-2H3v2zM3 3v2h18V3H3zm8 6h10V7H11v2zm0 4h10v-2H11v2z"/></svg>
                </button>
                <button class="format-btn" onclick="apply('indent')" title="Indent">
                    <svg viewBox="0 0 24 24"><path d="M3 21h18v-2H3v2zM3 8v8l4-4-4-4zm8 9h10v-2H11v2zM3 3v2h18V3H3zm8 6h10V7H11v2zm0 4h10v-2H11v2z"/></svg>
                </button>
            </div>

            <div class="format-group">
                <button class="format-btn" onclick="apply('justifyLeft')"><svg viewBox="0 0 24 24"><path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/></svg></button>
                <button class="format-btn" onclick="apply('justifyCenter')"><svg viewBox="0 0 24 24"><path d="M7 15v2h10v-2H7zm-4-4h18v2H3v-2zm4-4h10v2H7V7zm-4-4h18v2H3V3zm4 16h10v2H7v-2z"/></svg></button>
            </div>

            <button class="action-btn" id="spellcheck-btn" onclick="toggleSpellcheck()">‚úîÔ∏è</button>
            <button class="action-btn" onclick="toggleDarkMode()">üåì</button>
        </div>
    </nav>

    <div class="workspace">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-label">
                    Documents 
                    <button class="action-btn" onclick="createNewFile()" style="font-size: 10px; padding: 2px 5px;">+ NEW</button>
                </div>
                <ul id="file-list"></ul>
            </div>
            
            <div class="sidebar-section" style="flex-grow: 1; display: flex; flex-direction: column;">
                <div class="sidebar-label">Notes</div>
                <textarea id="notes-area" placeholder="Character arcs, plot points..."></textarea>
            </div>
        </aside>

        <main class="main-container">
            <div id="editor" contenteditable="true" spellcheck="true"></div>
        </main>
    </div>

    <footer>
        <div id="stats">Words: 0 | Reading Time: 0 min</div>
        <div style="display: flex; gap: 8px;">
            <button class="action-btn download-btn" onclick="downloadDraft()">Download .html</button>
        </div>
    </footer>

    <script>
        const editor = document.getElementById('editor');
        const notes = document.getElementById('notes-area');
        const fileList = document.getElementById('file-list');
        const sidebar = document.getElementById('sidebar');

        let documents = JSON.parse(localStorage.getItem('writer_docs')) || { "Default": "<div>Start your story...</div>" };
        let currentDoc = localStorage.getItem('writer_current_doc') || "Default";

        function init() {
            renderFileList();
            loadDocument(currentDoc);
            notes.value = localStorage.getItem('writer_notes_v6') || '';
            if (localStorage.getItem('writer_theme') === 'dark') document.body.classList.add('dark-mode');
            updateStats();
        }

        function renderFileList() {
            fileList.innerHTML = '';
            Object.keys(documents).forEach(name => {
                const li = document.createElement('li');
                li.className = `file-item ${name === currentDoc ? 'active' : ''}`;
                li.innerHTML = `<span>${name}</span> <span class="delete-file" onclick="deleteFile(event, '${name}')">‚úï</span>`;
                li.onclick = () => loadDocument(name);
                fileList.appendChild(li);
            });
        }

        function loadDocument(name) {
            documents[currentDoc] = editor.innerHTML; // Save current before switching
            currentDoc = name;
            editor.innerHTML = documents[name];
            localStorage.setItem('writer_current_doc', currentDoc);
            renderFileList();
            updateStats();
        }

        function createNewFile() {
            const name = prompt("Enter document name:");
            if (name && !documents[name]) {
                documents[name] = "<div>New Chapter...</div>";
                saveDocs();
                loadDocument(name);
            }
        }

        function deleteFile(e, name) {
            e.stopPropagation();
            if (Object.keys(documents).length === 1) return alert("Must keep at least one document.");
            if (confirm(`Delete ${name}?`)) {
                delete documents[name];
                if (currentDoc === name) currentDoc = Object.keys(documents)[0];
                saveDocs();
                init();
            }
        }

        function saveDocs() { localStorage.setItem('writer_docs', JSON.stringify(documents)); }

        editor.addEventListener('input', () => {
            documents[currentDoc] = editor.innerHTML;
            saveDocs();
            updateStats();
        });

        notes.addEventListener('input', () => localStorage.setItem('writer_notes_v6', notes.value));

        function toggleSidebar() { sidebar.classList.toggle('hidden'); }
        function apply(cmd, val = null) { document.execCommand(cmd, false, val); editor.focus(); }
        function updateStats() {
            const text = editor.innerText.trim();
            const words = text ? text.split(/\s+/).length : 0;
            document.getElementById('stats').innerText = `Words: ${words} | Reading Time: ~${Math.ceil(words / 200)} min`;
        }
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('writer_theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }
        function downloadDraft() {
            const blob = new Blob([editor.innerHTML], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${currentDoc}.html`;
            a.click();
        }

        editor.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                if (e.shiftKey) apply('outdent'); else apply('indent');
            }
        });

        window.onload = init;
    </script>
</body>
</html>
